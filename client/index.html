<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Medal Bypass</title>
    <meta name="title" content="Medal Bypass" />
    <meta
      name="description"
      content="Download Medal Clips Easily Without Watermarks!"
    />
    <meta name="theme-color" content="#553EA8" />
    <meta
      name="keywords"
      content="Medal,Download,Free,Watermark,Clips,Fortnite,Rocketleague,Valorant,Roblox"
    />
    <meta name="robots" content="index, follow" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="language" content="English" />
    <meta name="author" content="Tyson3101" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <link
      rel="manifest"
      crossorigin="use-credentials"
      href="site.webmanifest"
    />
    <script defer src="/_vercel/insights/script.js"></script>
    <style>
      :root {
        --text-color: rgb(0, 183, 134);
      }
    </style>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body data-clips-shown="false">
    <div class="inputArea">
      <div class="header">
        <h1 aria-label="Header">Medal Bypass</h1>
        <span id="desc" aria-label="Description"
          >Bypasses the requirement of Medal Premium in order to download clips
          without watermarks!</span
        >
      </div>
      <input
        type="text"
        id="textbox"
        style="width: 70vw"
        aria-label="Input Medal Link Area"
        placeholder="Copy and Paste the Medal Clip URL/ID Here"
      />
      <button aria-label="Download Medal Clip">Download</button>
      <a href="https://i.imgur.com/IFMBxNv.png" target="_blank" class="linkHelp"
        >Click here to see how to get the Medal Link or ID</a
      >
      <a
        href="https://github.com/Tyson3101/Medal-Bypass/issues/new"
        target="_blank"
        class="linkIssues"
        >Having issues? Post an issue on the Github Page</a
      >
      <p
        style="display: none; font-size: x-large"
        id="loading"
        aria-label="Loading"
      ></p>
    </div>

    <!-- Bottom left section -->
    <p
      style="
        display: flex;
        justify-content: end;
        align-items: flex-end;
        position: fixed;
        bottom: 0;
        left: 0;
        font-size: 0.75em;
        gap: 0.5em;
        font-weight: bold;
        margin-left: 1em;
      "
    >
      <a
        aria-label="Github Page"
        target="_blank"
        style="text-decoration: none; display: inline; color: inherit"
        href="https://github.com/Tyson3101/Medal-Bypass"
      >
        <i style="font-size: 3rem" class="fa fa-github"></i>
      </a>
      <i
        style="
          display: inline-block;
          transform: scaleY(3.8);
          position: relative;
          top: -1.5rem;
          pointer-events: none;
        "
        >|</i
      >
      <span style="position: relative; top: -6px">
        <a
          aria-label="How it works"
          target="_blank"
          style="text-decoration: none; display: inline; color: inherit"
          href="https://youtu.be/chbzCxr5FpM"
        >
          How It Works?
        </a>
      </span>
    </p>

    <!-- Bottom right section -->
    <p
      style="
        position: fixed;
        bottom: 0;
        right: 0;
        font-size: 0.75em;
        font-weight: bold;
        margin-right: 1em;
        text-align: right;
      "
    >
      <span style="font-size: smaller">Check out my other work:</span><br />
      <a
        href="https://chrome.google.com/webstore/detail/ckbnikemebopgknkpgjlkbffpkkhblbe"
        target="_blank"
        style="
          text-decoration: none;
          display: inline-block;
          padding: 0;
          margin: 0;
          color: rgb(0, 183, 165);
        "
        >Auto YT Shorts Scroller</a
      ><br />
      <a
        href="https://chrome.google.com/webstore/detail/egmgebeelgaakhaoodlmnimbfemfgdah"
        target="_blank"
        style="
          text-decoration: none;
          display: inline-block;
          padding: 0;
          margin: 0;
          color: rgb(0, 183, 165);
        "
        >Redirect Blocker</a
      ><br />
      <a
        href="https://tyson3101.com"
        target="_blank"
        style="
          text-decoration: overline;
          display: inline-block;
          padding: 0;
          margin-top: 2px;
          color: rgb(0, 183, 165);
          font-size: 0.9em;
        "
        >Tyson3101.com</a
      >
    </p>

    <div id="videos"></div>

    <script>
      // Constants
      const ERROR_MESSAGE = `Please enter a valid Medal clip URL/ID.
Make sure you have copied the URL/ID correctly and the clip is not private.
OR
Wait a couple of seconds and try again.`;
      const LOADING_MESSAGE = `Bypassing Watermark`;
      const COOLDOWN_START = 3;

      // Variables
      let loadingInterval;
      let lastURLs = [];
      let cooldown = 0;

      // DOM Elements
      const videosContainer = document.querySelector("#videos");
      const loading = document.querySelector("p");
      const button = document.querySelector("button");

      // Event Listener for button click
      button.addEventListener("click", () => downloadVideo());

      // Check if URL is provided in params
      const params = new URLSearchParams(document.location.search);
      if (params.get("url")?.length) {
        downloadVideo(params.get("url"));
      }

      // Function to download video
      async function downloadVideo(initialURL) {
        let url = document.querySelector("input").value;

        // Checks URL Param if no URL is entered
        if (initialURL?.length && !url.length) {
          url = initialURL;
        }

        // Checks if valid URL
        if (!url) return showError("Please enter a valid Medal clip URL/ID.");
        if (!url.toLowerCase().includes("medal")) {
          if (!url.includes("/") && !url.includes(" "))
            url = "https://medal.tv/clips/" + url;
          else return showError("Please enter a valid Medal clip URL/ID.");
        }
        if (!url.toLowerCase().includes("https://")) {
          url = "https://" + url;
        }

        if (!url.toLowerCase().includes("?mobilebypass=true")) {
          url += "?mobilebypass=true";
        }

        url = url.replace("?theater=true", "");

        // Clip ID
        const id = url.split("/clips/")[1].split("/")[0];

        // Check if downloading or already downloaded
        if (lastURLs.some((u) => id === u.id))
          return alert("You already downloaded this clip!");
        if (cooldown > 0) return alert("Please wait " + cooldown + " seconds.");

        cooldown = COOLDOWN_START;
        button.disabled = true;
        button.style.cursor = "not-allowed";
        button.innerText = "Wait " + cooldown + " seconds!";

        lastURLs.push({ id, active: true }); // History of clips
        startLoading();

        // Creating elements
        const containerElement = document.createElement("div");
        const videoElement = document.createElement("video");
        const aElement = document.createElement("a");
        containerElement.classList.add("video");
        aElement.download = "MedalTV_" + id + ".mp4";
        aElement.innerText = "Download Here";
        const data = { url };

        try {
          // Sending URL to server to download clip without watermark
          const fetchData = await fetch(
            "https://us-central1-medalbypass.cloudfunctions.net/medalwatermark",
            {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(data),
            }
          ).catch((e) => showError(ERROR_MESSAGE, true));
          const video = await fetchData?.json(); // Returns download link

          // Edit history to link toggle link to done
          lastURLs[lastURLs.findIndex((u) => u.id === id)].active = false;

          // Check if valid
          stopLoading(!!video?.valid);
          if (!video?.valid) {
            // Remove url from history
            lastURLs.splice(
              lastURLs.findIndex((u) => u.id === id),
              1
            );
            return showError(ERROR_MESSAGE, true);
          }

          // Add download btn and video to screen
          aElement.href = video.src;
          videoElement.src = video.src;
          videoElement.controls = true;
          containerElement.prepend(videoElement);
          containerElement.prepend(aElement);
          videosContainer.prepend(containerElement);
          document.body.dataset["clipsShown"] = "true";
        } catch {
          // For errors
          lastURLs.splice(
            lastURLs.findIndex((u) => u.id === id),
            1
          );
          stopLoading();
          return showError(ERROR_MESSAGE, true);
        }
      }

      // Function to start loading animation
      function startLoading() {
        if (loadingInterval) clearInterval(loadingInterval);
        loading.style.display = "block";
        document.querySelector(".linkHelp").style.display = "none";
        document.querySelector(".linkIssues").style.display = "none";
        loading.innerText = LOADING_MESSAGE;
        let numOfDots = 0;
        loadingInterval = setInterval(() => {
          numOfDots += 1;
          if (numOfDots >= 4) numOfDots = 0;
          loading.innerText = LOADING_MESSAGE + ".".repeat(numOfDots);
        }, 500);
      }

      // Function to stop loading animation
      function stopLoading(successful = true) {
        if (lastURLs.some((u) => u.active)) return;
        if (loadingInterval) clearInterval(loadingInterval);
        loading.style.display = "none";
        if (!successful) {
          document.querySelector(".linkHelp").style.display = "block";
          document.querySelector(".linkIssues").style.display = "block";
        }
      }

      // Function to show/alert error
      function showError(errMsg, showGHIssue = false) {
        alert(errMsg);
        document.querySelector(".linkHelp").style.display = "block";
        if (showGHIssue) {
          document.querySelector(".linkIssues").style.display = "block";
        }
      }

      // Cooldown timer
      setInterval(() => {
        if (cooldown > 0) {
          button.disabled = true;
          button.style.cursor = "not-allowed";
          button.innerText = "Wait " + cooldown + " seconds!";
          cooldown--;
        } else {
          button.disabled = false;
          button.style.cursor = "pointer";
          if (button.innerText !== "Download")
            button.innerText = "Download Another Clip";
        }
      }, 1000);

      // Vercel Analytics for Page Views and such
      window.va =
        window.va ||
        function () {
          (window.vaq = window.vaq || []).push(arguments);
        };
    </script>
  </body>
</html>
