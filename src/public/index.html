<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Medal Bypass</title>
    <meta name="title" content="Medal Bypass" />
    <meta
      name="description"
      content="Download Medal Clips Easily Without Watermarks!"
    />
    <meta name="theme-color" content="#553EA8" />
    <meta
      name="keywords"
      content="Medal,Download,Free,Clips,Fortnite,Rocketleague,Valorant"
    />
    <meta name="robots" content="index, follow" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="language" content="English" />
    <meta name="author" content="Tyson3101" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link
      rel="manifest"
      crossorigin="use-credentials"
      href="site.webmanifest"
    />
    <style>
      body {
        font-family: Arial, Helvetica, sans-serif;
        color: rgb(0, 183, 134);
        background-color: rgb(29, 25, 25);
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        text-align: center;
      }
      video {
        width: 40vw;
        height: auto;
        aspect-ratio: 16 / 9;
      }
      a {
        display: block;
        padding: 0.5rem 0;
        color: rgb(179, 179, 238);
      }
      a:hover {
        color: rgb(120, 120, 205);
      }
      input {
        width: 40vw;
        height: 1.5rem;
      }
      button {
        margin-top: 1em;
        display: block;
        padding: 1rem;
        margin-bottom: 1em;
        cursor: pointer;
      }
      span {
        font-size: xx-large;
        font-weight: bolder;
      }
      #desc {
        font-size: 0.8em;
        font-weight: normal;
        display: block;
        margin-bottom: 1.4em;
      }
      h1 {
        margin-top: 0;
        margin-bottom: 0;
        font-size: 3rem;
      }
      .countdown {
        margin: 0;
      }
      @media (max-width: 517px) {
        .countdown {
          font-size: 3vw;
          transform: scaleY(1.3);
        }
      }
    </style>
  </head>
  <body>
    <h1 aria-label="Header">Medal Bypass</h1>
    <span id="desc" aria-label="Description"
      >Bypasses the requirement of Medal Premium in order to download clips
      without watermarks!</span
    >
    <input
      type="text"
      id="textbox"
      style="width: 70vw"
      aria-label="Input Medal Link Area"
      placeholder="Copy and Paste Medal Clip Here"
    />
    <button aria-label="Download Medal Clip">Download</button>
    <p style="display: none; font-size: x-large" id="loading">Loading.</p>
    <h6
      style="
        position: absolute;
        bottom: 0;
        right: 0;
        text-align: left;
        margin-right: 1em;
      "
    >
      <a
        style="text-decoration: none; display: inline; color: inherit"
        href="https://github.com/Tyson3101"
      >
        By Tyson3101</a
      >
    </h6>
    <script>
      let loadingInterval;
      let lastURLs = [];
      const loading = document.querySelector("p");
      document.querySelector("button").addEventListener("click", downloadVideo);
      const params = new URLSearchParams(document.location.search);
      if (params.get("url")?.length) {
        downloadVideo(params.get("url"));
      }

      async function downloadVideo(initialURL) {
        let url = document.querySelector("input").value;
        if (initialURL?.length) {
          url = initialURL;
        }
        if (lastURLs.includes(url))
          return alert("Medal clip already downloading/downloaded!");
        if (!url.length || !url.toLowerCase().includes("medal"))
          return alert("Please input a vaild medal clip!");
        lastURLs.push(url);
        const videoElement = document.createElement("video");
        const aElement = document.createElement("a");
        const pElement = document.createElement("p");
        pElement.classList.add("countdown");
        aElement.target = "_blank";
        aElement.download = "MedalDownload";
        aElement.innerText = "Download Here";
        const data = { url };
        startLoading();
        try {
          const fetchData = await fetch(
            "https://us-central1-medalbypass.cloudfunctions.net/video",
            {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(data),
            }
          );
          const video = await fetchData.json();
          stopLoading();
          if (!video.valid)
            return alert(
              "Please input a vaild Medal clip! (Make sure it's not private, etc..)"
            );
          aElement.href = video.src;
          videoElement.src = video.src;
          videoElement.controls = true;
          document.body.appendChild(aElement);
          document.body.appendChild(videoElement);
          document.body.appendChild(pElement);
          startCountdown({ pElement, aElement, videoElement });
        } catch {
          return alert(
            "Please input a vaild Medal clip! (Make sure it's not private, etc..)"
          );
        }
      }

      function startCountdown({ pElement, aElement, videoElement }) {
        if (!pElement) return;
        let seconds = 890;
        let interval = setInterval(() => {
          seconds -= 1;
          pElement.innerText = `Time left to download: ${Math.floor(
            seconds / 60
          )}:${
            `${seconds % 60}`.length === 2 ? seconds % 60 : "0" + (seconds % 60)
          }`;
          if (seconds <= 0) {
            pElement.remove();
            aElement?.remove();
            videoElement?.remove();
            clearInterval(interval);
          }
        }, 1000);
      }

      function startLoading() {
        if (loadingInterval) clearInterval(loadingInterval);
        loading.style.display = "block";
        let numOfDots = 1;
        loadingInterval = setInterval(() => {
          numOfDots += 1;
          if (numOfDots >= 4) numOfDots = 1;
          loading.innerText = "Loading" + ".".repeat(numOfDots);
        }, 500);
      }
      function stopLoading() {
        if (loadingInterval) clearInterval(loadingInterval);
        loading.style.display = "none";
      }
    </script>
  </body>
</html>
