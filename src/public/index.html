<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Medal Bypass</title>
    <meta name="title" content="Medal Bypass" />
    <meta name="description" content="Download Medal Clips Easily!" />
    <meta name="theme-color" content="#553EA8" />
    <meta
      name="keywords"
      content="Medal,Download,Free,Clips,Fortnite,Rocketleague,Valorant"
    />
    <meta name="robots" content="index, follow" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="language" content="English" />
    <meta name="author" content="Tyson3101" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link
      rel="manifest"
      crossorigin="use-credentials"
      href="site.webmanifest"
    />
    <style>
      body {
        font-family: Arial, Helvetica, sans-serif;
        color: rgb(0, 183, 134);
        background-color: rgb(29, 25, 25);
      }
      a {
        display: block;
        padding: 0.5rem 0;
      }
      a:hover {
        color: rgb(127, 127, 223);
      }
      input {
        width: 40vw;
        height: 1.5rem;
      }
      button {
        margin-top: 1em;
        display: block;
        padding: 1rem;
        margin-bottom: 1em;
        cursor: pointer;
      }
      span {
        font-size: xx-large;
        font-weight: bolder;
      }
      #desc {
        font-size: 0.8em;
        font-weight: normal;
        display: block;
        margin-bottom: 1.4em;
      }
      h1 {
        margin-top: 0;
        margin-bottom: 0;
        font-size: 3rem;
      }
    </style>
  </head>
  <body>
    <h1 aria-label="Header">Medal Bypass</h1>
    <span id="desc" aria-label="Description"
      >Bypasses the requirement of Medal Premium in order to download
      clips!</span
    >
    <input
      type="text"
      id="textbox"
      style="width: 70vw"
      aria-label="Input Medal Link Area"
      placeholder="Copy and Paste Medal Clip Here"
    />
    <button aria-label="Download Medal Clip">Download</button>
    <p style="display: none; font-size: x-large" id="loading">Loading...</p>
    <script>
      let lastURL = "";
      const loading = document.querySelector("p");
      document.querySelector("button").addEventListener("click", downloadVideo);

      const params = new URLSearchParams(document.location.search);

      if (params.get("url")?.length) {
        downloadVideo(params.get("url"));
      }
      async function downloadVideo(initialURL) {
        let url = document.querySelector("input").value;
        if (initialURL) {
          url = initialURL;
        }
        console.log({ url });
        if (lastURL === url && url.length)
          return alert("Medal clip already downloading/downloaded");
        if (!url.length) return alert("... ?");
        lastURL = url;
        const videoElement = document.createElement("video");
        videoElement.style.width = "40vw";
        videoElement.style.height = "auto";
        videoElement.style.aspectRatio = "16 / 9";
        const aElement = document.createElement("a");
        aElement.download = "MedalDownload";
        aElement.innerText = "Download Here";
        const data = { url };
        loading.style.display = "block";
        const fetchData = await fetch(
          "https://us-central1-medalbypass.cloudfunctions.net/video",
          {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data),
          }
        );
        const video = await fetchData.json();
        loading.style.display = "none";
        if (!video.valid)
          return alert(
            "Please input a vaild Medal clip! (Make sure it's not unlisted, etc..)"
          );
        if (video.src.includes("cdn.medal.tv/")) aElement.target = "_blank";
        aElement.href = video.src;
        videoElement.src = video.src;
        videoElement.controls = true;
        document.body.appendChild(aElement);
        document.body.appendChild(videoElement);
        console.log("Done");
      }
    </script>
  </body>
</html>
